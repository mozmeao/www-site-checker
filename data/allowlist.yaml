# The allowlist has a per-site setup, so that links from SiteA do not have to be allowed from SiteB

# The allowlist doesn't _have_ to be grouped/structured, but it should help
# with quickly getting a sense for what is included here

# Remember that any scalar strings featuring escaped characters must be single-quoted in YAML

bedrock_base_config: &bedrock_base_config
  allowed_outbound_url_regexes:
    # === Broad, trusted cases ===
    - '^(\/|#).*' # Relative URLs and in-page anchors are OK

    # === Mozilla-run things ===
    - '^https?:\/\/[^\/]+.mozilla.org($|\/(.*))'
    - '^https?:\/\/[^\/]+.mozilla.com($|\/(.*))'
    - '^https?:\/\/[^\/]+.firefox.com($|\/(.*))'

    - '^https?:\/\/[^\/]+.mozilla.design($|\/(.*))'
    - '^https?:\/\/[^\/]+.mozillians.org($|\/(.*))'
    - '^https?:\/\/assets.mozilla.net\/(.*)'
    - '^https?:\/\/bugzil.la\/(\d*)$'
    - '^https?:\/\/getpocket.com\/(.*)'
    - '^https?:\/\/mzl.la\/(.*)'
    - '^https?:\/\/searchfox.org\/(.*)'
    - '^https?:\/\/videos.cdn.mozilla.net\/(.*)'

    # === Mozilla on Github

    - '^https:\/\/github.com\/(mozilla|mozilla-mobile|mozilla-services|mozilla-tw)\/.*'
    - '^https?:\/\/mozilla.github.io($|\/(.*))'
    - '^https?:\/\/mozilladevelopers.github.io($|\/(.*))'
    - '^https?:\/\/mozillagfx.wordpress.com($|\/(.*))'

    # pages linked to from our own security advisories - eg https://www.mozilla.org/en-US/security/advisories/mfsa2006-50/ -> mfsa2006-01.html
    - '^mfsa\d{4}-\d{2}(.html){0,1}$'

    # mailto links to Mozilla itself
    - "^mailto:[^@]+@mozilla.(com|org)$"

    # === Mobile downloads, direct and via adjust.com

    - '^https:\/\/itunes.apple.com\/[a-z]{0,2}\/{0,1}app\/firefox-private-safe-browser\/id989804926($|\?.*)'
    - '^https:\/\/play.google.com\/store\/apps\/details\?id=org.mozilla.(firefox|firefox_beta|fenix)($|&hl=[a-z]{2}|&referrer=.*)'
    - '^https:\/\/app.adjust.com\/2uo1qc\?redirect=https%3A%2F%2Fitunes\.apple\.com%2F[a-z]{0,2}(%2F){0,1}app%2Ffirefox-private-safe-browser%2Fid989804926&campaign=www\.mozilla\.org&adgroup=[a-z-_]+$'
    - '^https:\/\/app\.adjust\.com\/2uo1qc\?redirect=https%3A%2F%2Fplay\.google\.com%2Fstore%2Fapps%2Fdetails%3Fid%3Dorg\.mozilla\.firefox&campaign=www\.mozilla\.org&adgroup=[a-z-_]+$'
    - '^https:\/\/app.adjust.com\/m54twk\?redirect=https%3A%2F%2Fitunes\.apple\.com%2F[a-z]{0,2}(%2F){0,1}app%2Fpocket-save-read-grow%2Fid309601447&campaign=www\.mozilla\.org&adgroup=[a-z-_]+$'
    - '^https:\/\/app\.adjust\.com\/m54twk\?redirect=https%3A%2F%2Fplay\.google\.com%2Fstore%2Fapps%2Fdetails%3Fid%3Dcom\.ideashower\.readitlater\.pro&campaign=www\.mozilla\.org&adgroup=[a-z-_]+$'

    # === Trusted third-party sites ===

    # CVEs at mitre.org
    - '^https?:\/\/(www.){0,1}cve.mitre.org\/cgi-bin\/cvename.cgi\?name=(CVE|CAN)-\d{4}-\d{4,5}$'

    # CVEs at NIST
    - '^https?:\/\/nvd.nist.gov\/nvd.cfm\?cvename=CVE-\d{4}-\d{4}$'

    # === Special cases ===

    # Limited traversal allowed for references to releasenotes pages on /firefox/releases/
    - '^(..\/)([0-9]*.[0-9a-z]*.{0,1}[a-z0-9]*)\/releasenotes\/.*'
    - '^..\/2.0.0.\d{1,2}\/releasenotes\/.*'

    # Legacy release notes, eg `1.0.3.html`` linked from www.mozilla.org/en-US/firefox/releases/, that get redirected:
    - '^([0-1]{1}.\d{1}.{0,1}\d{0,2}.{0,1}\d{0,2}).html$'

    # References back up the tree from within security advisory pages
    - '^..\/200\d{1,2}\/mfsa200\d{1,2}-\d{2}.html$'

  allowed_outbound_url_literals:
    # Internals
    - "about:plugins"

    # App store links not covered by the regexes above
    - "https://app.adjust.com/qywno6t?redirect=https%3A%2F%2Fitunes.apple.com%2Fapp%2Fid1314000270%3Fmt%3D8"

    # Things we're using to get stuff done
    - "https://docs.google.com/forms/d/1rwLVzr1Fql9ZtAKkG_z5jcRczn2uy84zqwBX9gX52OY/viewform" # Google Form for Credits-page request

    # Trusted third-party URLs
    - "http://commonspace.wordpress.com/" # Mark Surman's blog
    - "http://commonspace.wordpress.com/category/hybrid/" # Mark Surman's blog
    - "http://citizencodeofconduct.org/"
    - "http://code.google.com/p/ots/"
    - "http://code.google.com/apis/safebrowsing/firefox3_privacy.html"
    - "http://code.google.com/p/chromium/issues/detail?id=78524"
    - "http://copybuzz.com/copyright/interview-raegan-macdonald/"
    - "http://creativecommons.org/licenses/by-sa/3.0/"
    - "http://creativecommons.org/privacy"
    - "http://creativecommons.org/publicdomain/zero/1.0/"
    - https://app.adjust.com/qywno6t?redirect=https%3A%2F%2Fitunes.apple.com%2Fapp%2Fid1314000270%3Fmt%3D8

    # RFCs, etc
    - "http://tools.ietf.org/html/rfc5280#section-4.2.1.12"
    - "http://tools.ietf.org/html/rfc5280#section-6.1.4"
    - "http://tools.ietf.org/html/rfc6265#section-4.1.1"
    - "http://www.ietf.org/rfc/rfc0959.txt"
    - "http://www.ietf.org/rfc/rfc2616.txt"
    - "http://www.ietf.org/rfc/rfc3986.txt"
    - "http://www.ietf.org/rfc/rfc6125.txt"
    - "https://tools.ietf.org/html/4287"
    - "https://tools.ietf.org/html/draft-ietf-httpbis-alt-svc-04"
    - "https://tools.ietf.org/html/rfc3279#section-2.2.1"
    - "https://tools.ietf.org/html/rfc3279#section-2.3.1"
    - "https://tools.ietf.org/html/rfc4055#section-6"
    - "https://tools.ietf.org/html/rfc5480#section-2.1.1"
    - "https://tools.ietf.org/html/rfc5758#section-3.2"
    - "https://tools.ietf.org/html/rfc8017#appendix-A.1"

    # Security advisories
    - "http://secunia.com/advisories/10419/"
    - "http://secunia.com/advisories/12712"
    - "http://secunia.com/advisories/13129/"
    - "http://secunia.com/advisories/13258"
    - "http://secunia.com/advisories/13599"
    - "http://secunia.com/advisories/15489/"
    - "http://secunia.com/advisories/15549/"
    - "http://secunia.com/advisories/15601/"
    - "http://secunia.com/advisories/19802/"
    - "http://secunia.com/advisories/19873"
    - "http://secunia.com/advisories/26201/"
    - "http://secunia.com/advisories/37242"
    - "http://www.kb.cert.org/vuls/id/403150"
    - "http://www.kb.cert.org/vuls/id/783400"
    - "http://www.kb.cert.org/vuls/id/845620"
    - "http://www.zerodayinitiative.com/"
    - "http://www.zerodayinitiative.com/advisories/ZDI-06-009.html"
    - "http://www.zerodayinitiative.com/advisories/ZDI-06-010.html"
    - "http://www.zerodayinitiative.com/advisories/ZDI-06-011.html"
    - "http://www.zerodayinitiative.com/advisories/ZDI-06-025.html"
    - "http://www.zerodayinitiative.com/advisories/ZDI-06-051.html"

    # Social accounts
    - "https://www.instagram.com/firefox/"
    - "https://www.instagram.com/mozilla/"
    - "https://www.instagram.com/unfcktheinternet/"

    # Specific YouTube videos
    - "https://www.youtube.com/t/terms"
    - "https://www.youtube.com/user/firefoxchannel"
    - "https://www.youtube.com/watch?v=6Ck1d6qo8a0"
    - "https://www.youtube.com/watch?v=A_dZVbYJtsk"
    - "https://www.youtube.com/watch?v=baPF-sOXP24"
    - "https://www.youtube.com/watch?v=f_f5wNw-2c0"
    - "https://www.youtube.com/watch?v=kw9LiqF-lNw"
    - "https://www.youtube.com/watch?v=LuEX_Wih8g4"
    - "https://www.youtube.com/watch?v=T2jykykN3yc"
    - "https://www.youtube.com/watch?v=t3NKmmWfklU"
    - "https://www.youtube.com/watch?v=ug6tA6fhhdQ"
    - "https://www.youtube.com/watch?v=Un3u4wuGT8Q"
    - "https://www.youtube.com/watch?v=zZzl649NcD0"

    # Usenet links
    - "news://alt.fan.mozilla"
    - "news://alt.netscape.sucks"
    - "news://comp.infosystems.www.advocacy"
    - "news://comp.lang.java.advocacy"
    - "news://comp.os.linux.advocacy"
    - "news://comp.os.ms-windows.advocacy"
    - "news://comp.os.os2.advocacy"
    - "news://comp.sys.amiga.advocacy"
    - "news://comp.sys.be.advocacy"
    - "news://comp.sys.mac.advocacy"
    - "news://comp.unix.advocacy"
    - "news://gnu.misc.discuss"

bedrock_cdn:
  <<: *bedrock_base_config
  hostname: www.mozilla.org

origin_us:
  <<: *bedrock_base_config
  hostname: bedrock-prod.gcp.moz.works

origin_fr:
  <<: *bedrock_base_config
  hostname: bedrock.prod.fr.moz.works

localhost8000:
  <<: *bedrock_base_config
  hostname: localhost:8000

localhost8080:
  <<: *bedrock_base_config
  hostname: localhost:8080
#
#
# # Example additional site
# other_base_config: &other_base_config
#   allowed_outbound_url_regexes:
#     - 'https?:\/\/[^\/]+.example.com\/(.*)'
#   allowed_outbound_url_literals:
#     - 'https://other-example.com/two'

# other_site_1:
#   <<: *other_base_config
#   hostname: www.example.org

# other_site_2:
#   <<: *other_base_config
#   hostname: mirror.example.org
